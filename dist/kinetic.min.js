!function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define(i):e[t]=i()}("Kinetic",Function("return this")(),function(){return function(){function t(i){var s=i.el,n=i.velocityThreshold,o=i.amplitudeFactor,r=i.deltaThreshold,h=i.movingAvarageFilter;this.el=s,this.velocityThreshold=n||t.VELOCITY_THRESHOLD,this.amplitudeFactor=o||t.AMPLITUDE_FACTOR,this.deltaThreshold=r||t.DELTA_THRESHOLD,this.movingAvarageFilter=h||t.MOVING_AVARAGE_FILTER,this.events=[],this.position=new e(0,0),this.delta=new e(0,0),this.velocity=new e(0,0),this.amplitude=new e(0,0),this._offset=new e(0,0),this._startPosition=new e(0,0),this._pressed=!1,this._shouldNotify=!1,this._swiped=!1,this._framesCount=0,this._timestamp=0,this._elapsed=0}function e(t,e){this.x=t||0,this.y=e||0}var i=325;t.VELOCITY_THRESHOLD=10,t.AMPLITUDE_FACTOR=.8,t.DELTA_THRESHOLD=.5,t.MOVING_AVARAGE_FILTER=200,t.instances=[];var s,n;return t.digest=function(e){n=n||Date.now(),s=n+(0|e),t.notify(e),requestAnimationFrame(t.digest)},t.spawn=function(e){t.instances.push(e),e.handleEvents()},t.kill=function(e){var i=t.instances.indexOf(e);-1!=i&&(t.instances.splice(i,1),e.unhandleEvents())},t.notify=function(e){for(var i,s=0;s<t.instances.length;s++)i=t.instances[s],i.pressed()&&i.track(e),i.shouldNotify()&&i.notify(),i.swiped()&&i.swipe(e)},t.position=function(i){return new e(t.clientX(i),t.clientY(i))},t.clientX=function(t){return t.targetTouches?t.targetTouches[0].clientX:t.clientX},t.clientY=function(t){return t.targetTouches?t.targetTouches[0].clientY:t.clientY},t.Vector=e,t.prototype.listen=function(t){this.events.push(t)},t.prototype.stopListening=function(t){var e=this.events.indexOf(t);-1!=e&&this.events.splice(e,1)},t.prototype.track=function(t){if(this._timestamp=this._timestamp||t,6==this._framesCount){this._elapsed=t-this._timestamp,this._timestamp=t,this._framesCount=0;var e=this.delta.mul(this.movingAvarageFilter).idiv(1+this._elapsed);this.velocity=e.imul(.8).iadd(this.velocity.imul(.2))}else this._framesCount++},t.prototype.swipe=function(t){this._elapsed=t-this._timestamp,this.delta=this.amplitude.mul(Math.exp(-this._elapsed/i)),this.delta.length()>this.deltaThreshold?this._shouldNotify=!0:this._swiped=!1},t.prototype.notify=function(){for(var t=0;t<this.events.length;t++)this.events[t](this.position,this.delta);this.delta.zero(),this._shouldNotify=!1},t.prototype.shouldNotify=function(){return this._shouldNotify},t.prototype.pressed=function(){return this._pressed},t.prototype.swiped=function(){return this._swiped},t.prototype.handleEvents=function(){this.el.addEventListener("mousedown",this),this.el.addEventListener("pointerdown",this),this.el.addEventListener("touchstart",this),this.el.addEventListener("touchmove",this),this.el.addEventListener("touchend",this)},t.prototype.unhandleEvents=function(){this.el.removeEventListener("mousedown",this),this.el.removeEventListener("pointerdown",this),this.el.removeEventListener("touchstart",this),this.el.removeEventListener("touchmove",this),this.el.removeEventListener("touchend",this)},t.prototype.handleEvent=function(t){switch(t.preventDefault(),t.type){case"mousedown":case"pointerdown":this._mousedownHandler(t);break;case"pointermove":case"mousemove":this._mousemoveHandler(t);break;case"pointerup":case"mouseup":this._mouseupHandler(t);break;case"touchstart":this._touchstartHandler(t);break;case"touchmove":this._touchmoveHandler(t);break;case"touchend":this._touchendHandler(t)}},t.prototype.tap=function(i){var s=this.el.getBoundingClientRect();this._offset=new e(s.left,s.top),this._startPosition=t.position(i).isub(this._offset),this.velocity=new e(0,0),this.amplitude=new e(0,0),this._timestamp=0,this._framesCount=0,this._pressed=!0},t.prototype.drag=function(e){this.position=t.position(e).isub(this._offset),this.delta.iadd(this.position.sub(this._startPosition)),this._startPosition=this.position,this._shouldNotify=!0},t.prototype.release=function(){this.velocity.length()>this.velocityThreshold&&(this.amplitude=this.velocity.imul(this.amplitudeFactor),this._swiped=!0),this._framesCount=0,this._pressed=!1},t.prototype._mousedownHandler=function(t){document.addEventListener("mousemove",this),document.addEventListener("pointermove",this),document.addEventListener("mouseup",this),document.addEventListener("pointerup",this),this.tap(t)},t.prototype._mousemoveHandler=function(t){this.drag(t)},t.prototype._mouseupHandler=function(t){document.removeEventListener("pointermove",this),document.removeEventListener("mousemove",this),document.removeEventListener("pointerup",this),document.removeEventListener("mouseup",this),this.release()},t.prototype._touchstartHandler=function(t){this.tap(t)},t.prototype._touchmoveHandler=function(t){this.drag(t)},t.prototype._touchendHandler=function(t){this.release()},e.from=function(t){var i=t[0],s=t[1];return new e(i,s)},e.create=function(t,i){return new e(i*Math.cos(t),i*Math.sin(t))},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.iadd=function(t){return this.x+=t.x,this.y+=t.y,this},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.isub=function(t){return this.x-=t.x,this.y-=t.y,this},e.prototype.mul=function(t){return new e(this.x*t,this.y*t)},e.prototype.imul=function(t){return this.x*=t,this.y*=t,this},e.prototype.div=function(t){return new e(this.x/t,this.y/t)},e.prototype.idiv=function(t){return this.x/=t,this.y/=t,this},e.prototype.normalized=function(t){var i=this.x,s=this.y,n=Math.sqrt(i*i+s*s);return n>0?new e(i/n,s/n):new e(0,0)},e.prototype.normalize=function(t){var e=this.x,i=this.y,s=Math.sqrt(e*e+i*i);return s>0&&(this.x=e/s,this.y=i/s),this},e.prototype.distance=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.angle=function(){return Math.atan2(this.y,this.x)},e.prototype.zero=function(){return this.x=0,this.y=0,this},e.prototype.copy=function(){return new e(this.x,this.y)},e.prototype.toJSON=function(){return[this.x,this.y]},e.prototype.equal=function(t){return this.x==t.x&&this.y==t.y},t}()});
