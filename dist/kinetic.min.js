!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Kinetic=e()}(this,function(){"use strict";function t(t,e){this.x=t||0,this.y=e||0}function e(t){this.vector=t,this.__idx=0}function i(t){return t.activated()}function n(t){return t.activated()||t.pressed()}t.displayName="Vector",t.from=function(e){return new t(e[0],e[1])},t.fromAngle=function(e,i){return new t(i*Math.cos(e),i*Math.sin(e))},t.parse=function(e){return t.from(e.trim().replace(","," ").split(/\s+/).map(parseFloat))},t.add=function(t,e){return e.add(t)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.iadd=function(t,e){return e.iadd(t)},t.prototype.iadd=function(t){return this.x+=t.x,this.y+=t.y,this},t.sub=function(t,e){return e.sub(t)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.isub=function(t,e){return e.isub(t)},t.prototype.isub=function(t){return this.x-=t.x,this.y-=t.y,this},t.mul=function(t,e){return e.mul(t)},t.prototype.mul=function(e){return new t(this.x*e,this.y*e)},t.imul=function(t,e){return e.imul(t)},t.prototype.imul=function(t){return this.x*=t,this.y*=t,this},t.div=function(t,e){return e.div(t)},t.prototype.div=function(e){return new t(this.x/e,this.y/e)},t.idiv=function(t,e){return e.idiv(t)},t.prototype.idiv=function(t){return this.x/=t,this.y/=t,this},t.lerp=function(t,e,i){return t.lerp(e,i)},t.prototype.lerp=function(e,i){var n=(1-i)*this.x+i*e.x,s=(1-i)*this.y+i*e.y;return new t(n,s)},t.normalized=function(t){return t.normalized()},t.prototype.normalized=function(){var e=this.x,i=this.y,n=Math.sqrt(e*e+i*i);return n>0?new t(e/n,i/n):new t(0,0)},t.normalize=function(t){return t.normalize()},t.prototype.normalize=function(){var t=this.x,e=this.y,i=Math.sqrt(t*t+e*e);return i>0&&(this.x=t/i,this.y=e/i),this},t.magnitude=function(t){return t.magnitude()},t.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.dot=function(t,e){return e.dot(t)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.distance=function(t,e){return e.distance(t)},t.prototype.distance=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},t.angleOf=function(t){return t.angleOf()},t.prototype.angleOf=function(){return Math.atan2(this.y,this.x)},t.angleTo=function(t,e){return e.angleTo(t)},t.prototype.angleTo=function(t){return Math.acos(this.dot(t)/this.magnitude()*t.magnitude())},t.reset=function(t,e){return e.reset(t)},t.prototype.reset=function(t){return this.x=t.x,this.y=t.y,this},t.zero=function(t){return t.zero()},t.prototype.zero=function(){return this.x=0,this.y=0,this},t.copy=function(t){return t.copy()},t.prototype.copy=function(){return new t(this.x,this.y)},t.toJSON=function(t){return t.toJSON()},t.prototype.toJSON=function(){return[this.x,this.y]},t.toString=function(t){return t?t.toString():Function.prototype.toString.call(this)},t.prototype.toString=function(){return this.x.toFixed(3)+" "+this.y.toFixed(3)},t.equals=function(t,e){return t.equals(e)},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.compare=function(t,e){return t.compare(e)},t.prototype.compare=function(t){var e=this.magnitude(),i=t.magnitude();return(e>i)-(i>e)},Object.defineProperties(t.prototype,{xx:{configurable:!0,get:function(){return new t(this.x,this.x)},set:function(t){this.x=t.x,this.y=t.x}},xy:{configurable:!0,get:function(){return new t(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}},yx:{configurable:!0,get:function(){return new t(this.y,this.x)},set:function(t){this.x=t.y,this.y=t.x}},yy:{configurable:!0,get:function(){return new t(this.y,this.y)},set:function(t){this.x=t.y,this.y=t.y}}}),e.prototype.next=function(){return 0===this.__idx?(this.__idx++,{done:!1,value:this.vector.x}):1===this.__idx?(this.__idx++,{done:!1,value:this.vector.y}):{done:!0,value:void 0}},"undefined"!=typeof Symbol&&Symbol.iterator&&Object.defineProperty(t.prototype,Symbol.iterator,{configurable:!0,value:function(){return new e(this)}});var s,o,r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},u=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=100,h=function(){function e(i){var n=i.id;r(this,e),this.id=n,this.position=new t(0,0),this.delta=new t(0,0),this.velocity=new t(0,0),this.amplitude=new t(0,0),this._startPosition=new t(0,0),this._pressed=!1,this._activated=!1,this._swiped=!1,this._timestamp=0,this._trackTime=0,this._elapsed=0}return u(e,[{key:"tap",value:function(e){this.velocity=new t(0,0),this.amplitude=new t(0,0),this._startPosition=e,this._timestamp=0,this._trackTime=0,this._elapsed=0,this._pressed=!0}},{key:"drag",value:function(t){this.position=t,this.delta.iadd(this.position.sub(this._startPosition)),this._startPosition=this.position,this._activated=!0}},{key:"launch",value:function(t,e){this.velocity.magnitude()>t&&(this.amplitude=this.velocity.imul(e),this._swiped=!0),this._pressed=!1,this._trackTime=0}},{key:"track",value:function(t,e){if(this._timestamp=this._timestamp||t,this._trackTime=this._trackTime||t,t-this._trackTime>=a){this._elapsed=t-this._timestamp,this._timestamp=t,this._trackTime=0;var i=this.delta.mul(e).idiv(1+this._elapsed);this.velocity=i.lerp(this.velocity,.2)}}},{key:"swipe",value:function(t,e,i){this._elapsed=t-this._timestamp,this.delta=this.amplitude.mul(Math.exp(-this._elapsed/e)),this.delta.magnitude()>i?this._activated=!0:this._swiped=!1}},{key:"deactivate",value:function(){this.delta.zero(),this._activated=!1}},{key:"activated",value:function(){return this._activated}},{key:"pressed",value:function(){return this._pressed}},{key:"swiped",value:function(){return this._swiped}}]),e}(),c=window.requestAnimationFrame||window.webkitRequestAnimationFrame,d=325,l=-1,f=function(){function e(i){var n=i.el,s=i.velocityThreshold,o=i.amplitudeFactor,u=i.deltaThreshold,a=i.movingAvarageFilter;r(this,e),this.el=n,this.velocityThreshold=s||e.VELOCITY_THRESHOLD,this.amplitudeFactor=o||e.AMPLITUDE_FACTOR,this.deltaThreshold=u||e.DELTA_THRESHOLD,this.movingAvarageFilter=a||e.MOVING_AVARAGE_FILTER,this.pointers=[],this.events=[],this._offset=new t(0,0)}return u(e,null,[{key:"digest",value:function(t){s=s||Date.now(),o=s+(0|t),e.notify(o),c(e.digest)}},{key:"spawn",value:function(t){e.instances.push(t),t.handleEvents()}},{key:"kill",value:function(t){var i=e.instances.indexOf(t);i!==-1&&(e.instances.splice(i,1),t.unhandleEvents())}},{key:"notify",value:function(t){for(var i,n=0;n<e.instances.length;n++)i=e.instances[n],i.track(t),i.notify(),i.deactivate(),i.swipe(t),i.collect()}},{key:"position",value:function(i){return new t(e.clientX(i),e.clientY(i))}},{key:"clientX",value:function(t){return t.clientX}},{key:"clientY",value:function(t){return t.clientY}}]),u(e,[{key:"subscribe",value:function(t){this.events.push(t)}},{key:"unsubscribe",value:function(t){var e=this.events.indexOf(t);e!==-1&&this.events.splice(e,1)}},{key:"track",value:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];i.pressed()&&i.track(t,this.movingAvarageFilter)}}},{key:"notify",value:function(){for(var t=0;t<this.events.length;t++){var e=this.pointers.filter(i);e.length&&this.events[t](e)}}},{key:"deactivate",value:function(){for(var t=0;t<this.pointers.length;t++)this.pointers[t].deactivate()}},{key:"swipe",value:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];i.swiped()&&i.swipe(t,d,this.deltaThreshold)}}},{key:"collect",value:function(){this.pointers=this.pointers.filter(n)}},{key:"find",value:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.id===t)return i}return null}},{key:"add",value:function(t){this.pointers.push(t)}},{key:"handleEvents",value:function(){this.el.addEventListener("mousedown",this),this.el.addEventListener("pointerdown",this),this.el.addEventListener("touchstart",this),this.el.addEventListener("touchmove",this),this.el.addEventListener("touchend",this)}},{key:"unhandleEvents",value:function(){this.el.removeEventListener("mousedown",this),this.el.removeEventListener("pointerdown",this),this.el.removeEventListener("touchstart",this),this.el.removeEventListener("touchmove",this),this.el.removeEventListener("touchend",this)}},{key:"handleEvent",value:function(t){switch(t.preventDefault(),t.type){case"pointerdown":case"mousedown":this._mousedownHandler(t);break;case"mousemove":case"pointermove":this._mousemoveHandler(t);break;case"mouseup":case"pointerup":this._mouseupHandler(t);break;case"touchstart":this._touchstartHandler(t);break;case"touchmove":this._touchmoveHandler(t);break;case"touchend":this._touchendHandler(t)}}},{key:"getId",value:function(t){return null!=t.pointerId?t.pointerId:t.identifier?t.identifier:l}},{key:"tap",value:function(i){var n=this.el.getBoundingClientRect();this._offset=new t(n.left,n.top);var s=this.getId(i),o=this.find(s);o||(o=new h({id:s}),this.add(o)),o.tap(e.position(i).isub(this._offset))}},{key:"drag",value:function(t){var i=e.position(t).isub(this._offset),n=this.getId(t),s=this.find(n);s.drag(i)}},{key:"release",value:function(t){var e=this.getId(t),i=this.find(e);i.launch(this.velocityThreshold,this.amplitudeFactor)}},{key:"_mousedownHandler",value:function(t){document.addEventListener("mousemove",this),document.addEventListener("pointermove",this),document.addEventListener("mouseup",this),document.addEventListener("pointerup",this),this.tap(t)}},{key:"_mousemoveHandler",value:function(t){this.drag(t)}},{key:"_mouseupHandler",value:function(t){document.removeEventListener("pointermove",this),document.removeEventListener("mousemove",this),document.removeEventListener("pointerup",this),document.removeEventListener("mouseup",this),this.release(t)}},{key:"_touchstartHandler",value:function(t){for(var e=0;e<t.changedTouches.length;e++)this.tap(t.changedTouches[e])}},{key:"_touchmoveHandler",value:function(t){for(var e=0;e<t.targetTouches.length;e++)this.drag(t.targetTouches[e])}},{key:"_touchendHandler",value:function(t){for(var e=0;e<t.changedTouches.length;e++)this.release(t.changedTouches[e])}}]),e}();return f.Vector=t,f.VELOCITY_THRESHOLD=10,f.AMPLITUDE_FACTOR=.8,f.DELTA_THRESHOLD=.5,f.MOVING_AVARAGE_FILTER=200,f.instances=[],f});
