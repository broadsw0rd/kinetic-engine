!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Kinetic=e()}(this,function(){"use strict";function o(t){var e=t.id,i=t.Vector;this.id=e,this.Vector=i,this.position=new this.Vector(0,0),this.delta=new this.Vector(0,0),this.velocity=new this.Vector(0,0),this.amplitude=new this.Vector(0,0),this.startPosition=new this.Vector(0,0),this.pressed=!1,this.activated=!1,this.swiped=!1,this.timestamp=0,this.trackTime=0,this.elapsed=0}o.prototype.tap=function(t){this.velocity=new this.Vector(0,0),this.amplitude=new this.Vector(0,0),this.startPosition=t,this.timestamp=0,this.trackTime=0,this.elapsed=0,this.pressed=!0,this.swiped=!1},o.prototype.drag=function(t){this.position=t,this.delta.iadd(this.position.sub(this.startPosition)),this.startPosition=this.position,this.activated=!0},o.prototype.launch=function(t,e){this.velocity.magnitude()>t&&(this.amplitude=this.velocity.imul(e),this.swiped=!0),this.pressed=!1,this.trackTime=0},o.prototype.track=function(t,e){if(this.timestamp=this.timestamp||t,this.trackTime=this.trackTime||t,100<=t-this.trackTime){this.elapsed=t-this.timestamp,this.timestamp=t,this.trackTime=0;var i=this.delta.mul(e).idiv(1+this.elapsed);this.velocity=i.lerp(this.velocity,.2)}},o.prototype.swipe=function(t,e,i){this.elapsed=t-this.timestamp,this.delta=this.amplitude.mul(Math.exp(-this.elapsed/e)),this.delta.magnitude()>i?this.activated=!0:this.swiped=!1},o.prototype.deactivate=function(){this.delta.zero(),this.activated=!1};function u(){}function i(t){return t.activated}function e(t){return t.pressed}function t(t){return t.activated||t.pressed}function s(t){return t.swiped}function l(t){var e=t.el,i=t.Vector,s=t.velocityThreshold,n=t.amplitudeFactor,o=t.deltaThreshold,r=t.movingAvarageFilter,h=t.ondragstart,a=t.ondragmove,c=t.ondragend,p=t.onswipestart,d=t.onswipeend;this.el=e,this.Vector=i,this.velocityThreshold=s||l.VELOCITY_THRESHOLD,this.amplitudeFactor=n||l.AMPLITUDE_FACTOR,this.deltaThreshold=o||l.DELTA_THRESHOLD,this.movingAvarageFilter=r||l.MOVING_AVARAGE_FILTER,this.ondragstart=h||u,this.ondragmove=a||u,this.ondragend=c||u,this.onswipestart=p||u,this.onswipeend=d||u,this.pointers=[],this.events=[],this._swiped=!1,this.offset=new this.Vector(0,0)}return l.spawn=function(t){l.instances.push(t),t.handleEvents()},l.kill=function(t){var e=l.instances.indexOf(t);-1!==e&&(l.instances.splice(e,1),t.unhandleEvents())},l.notify=function(t){for(var e,i=0;i<l.instances.length;i++)(e=l.instances[i]).track(t),e.notify(),e.deactivate(),e.swipe(t),e.collect(),e.check()},l.clientX=function(t){return t.clientX},l.clientY=function(t){return t.clientY},l.prototype.position=function(t){return new this.Vector(l.clientX(t),l.clientY(t))},l.prototype.subscribe=function(t){this.events.push(t)},l.prototype.unsubscribe=function(t){var e=this.events.indexOf(t);-1!==e&&this.events.splice(e,1)},l.prototype.track=function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];i.pressed&&i.track(t,this.movingAvarageFilter)}},l.prototype.notify=function(){for(var t=0;t<this.events.length;t++){var e=this.pointers.filter(i);e.length&&this.events[t](e)}},l.prototype.deactivate=function(){for(var t=0;t<this.pointers.length;t++)this.pointers[t].deactivate()},l.prototype.swipe=function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];i.swiped&&i.swipe(t,325,this.deltaThreshold)}},l.prototype.collect=function(){this.pointers=this.pointers.filter(t)},l.prototype.check=function(){this._swiped?this.pointers.filter(s).length||(this._swiped=!1,this.onswipeend()):this.pointers.filter(s).length&&(this._swiped=!0,this.onswipestart())},l.prototype.find=function(t){for(var e=null,i=0;i<this.pointers.length;i++){var s=this.pointers[i];s.id===t&&(e=s)}return e||1===this.pointers.length&&this.pointers[0].swiped()&&((e=this.pointers[0]).id=t),e},l.prototype.add=function(t){this.pointers.push(t)},l.prototype.handleEvents=function(){this.el.addEventListener("mousedown",this,!0),this.el.addEventListener("touchstart",this,!0),this.el.addEventListener("touchmove",this,!0),this.el.addEventListener("touchend",this,!0),this.el.addEventListener("touchcancel",this,!0)},l.prototype.unhandleEvents=function(){this.el.removeEventListener("mousedown",this,!0),this.el.removeEventListener("touchstart",this,!0),this.el.removeEventListener("touchmove",this,!0),this.el.removeEventListener("touchend",this,!0),this.el.removeEventListener("touchcancel",this,!0)},l.prototype.handleEvent=function(t){switch(t.preventDefault(),t.type){case"mousedown":return this.mousedownHandler(t);case"mousemove":return this.mousemoveHandler(t);case"mouseup":return this.mouseupHandler(t);case"touchstart":return this.touchstartHandler(t);case"touchmove":return this.touchmoveHandler(t);case"touchend":case"touchcancel":return this.touchendHandler(t)}},l.prototype.getId=function(t){return t.identifier?t.identifier:-1},l.prototype.tap=function(t){var e=this.el.getBoundingClientRect();this.offset=new this.Vector(e.left,e.top);var i=this.getId(t),s=this.Vector,n=this.find(i);n||(n=new o({id:i,Vector:s}),this.add(n)),n.tap(this.position(t).isub(this.offset)),this.ondragstart()},l.prototype.drag=function(t){var e=this.position(t).isub(this.offset),i=this.getId(t);this.find(i).drag(e),this.ondragmove()},l.prototype.release=function(t){var e=this.getId(t);this.find(e).launch(this.velocityThreshold,this.amplitudeFactor),this.ondragend()},l.prototype.mousedownHandler=function(t){document.addEventListener("mousemove",this,!0),document.addEventListener("mouseup",this,!0),this.tap(t)},l.prototype.mousemoveHandler=function(t){"mousemove"!==t.type&&!this.pointers.filter(e).length||this.drag(t)},l.prototype.mouseupHandler=function(t){document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),this.release(t)},l.prototype.touchstartHandler=function(t){for(var e=0;e<t.changedTouches.length;e++)this.tap(t.changedTouches[e])},l.prototype.touchmoveHandler=function(t){for(var e=0;e<t.targetTouches.length;e++)this.drag(t.targetTouches[e])},l.prototype.touchendHandler=function(t){for(var e=0;e<t.changedTouches.length;e++)this.release(t.changedTouches[e])},l.VELOCITY_THRESHOLD=10,l.AMPLITUDE_FACTOR=.8,l.DELTA_THRESHOLD=.5,l.MOVING_AVARAGE_FILTER=200,l.instances=[],l});
