!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Kinetic=e()}(this,function(){"use strict";function t(){}function e(t){return t.activated()}function i(t){return t.pressed()}function s(t){return t.activated()||t.pressed()}function n(t){return t.swiped()}var o=function(t){var e=t.id,i=t.Vector;this.id=e,this.Vector=i,this.position=new this.Vector(0,0),this.delta=new this.Vector(0,0),this.velocity=new this.Vector(0,0),this.amplitude=new this.Vector(0,0),this._startPosition=new this.Vector(0,0),this._pressed=!1,this._activated=!1,this._swiped=!1,this._timestamp=0,this._trackTime=0,this._elapsed=0};o.prototype.tap=function(t){this.velocity=new this.Vector(0,0),this.amplitude=new this.Vector(0,0),this._startPosition=t,this._timestamp=0,this._trackTime=0,this._elapsed=0,this._pressed=!0},o.prototype.drag=function(t){this.position=t,this.delta.iadd(this.position.sub(this._startPosition)),this._startPosition=this.position,this._activated=!0},o.prototype.launch=function(t,e){this.velocity.magnitude()>t&&(this.amplitude=this.velocity.imul(e),this._swiped=!0),this._pressed=!1,this._trackTime=0},o.prototype.track=function(t,e){if(this._timestamp=this._timestamp||t,this._trackTime=this._trackTime||t,t-this._trackTime>=100){this._elapsed=t-this._timestamp,this._timestamp=t,this._trackTime=0;var i=this.delta.mul(e).idiv(1+this._elapsed);this.velocity=i.lerp(this.velocity,.2)}},o.prototype.swipe=function(t,e,i){this._elapsed=t-this._timestamp,this.delta=this.amplitude.mul(Math.exp(-this._elapsed/e)),this.delta.magnitude()>i?this._activated=!0:this._swiped=!1},o.prototype.deactivate=function(){this.delta.zero(),this._activated=!1},o.prototype.activated=function(){return this._activated},o.prototype.pressed=function(){return this._pressed},o.prototype.swiped=function(){return this._swiped};var r=function e(i){var s=i.el,n=i.Vector,o=i.velocityThreshold,r=i.amplitudeFactor,h=i.deltaThreshold,a=i.movingAvarageFilter,p=i.ondragstart,c=i.ondragmove,d=i.ondragend,u=i.onswipestart,l=i.onswipeend;this.el=s,this.Vector=n,this.velocityThreshold=o||e.VELOCITY_THRESHOLD,this.amplitudeFactor=r||e.AMPLITUDE_FACTOR,this.deltaThreshold=h||e.DELTA_THRESHOLD,this.movingAvarageFilter=a||e.MOVING_AVARAGE_FILTER,this.ondragstart=p||t,this.ondragmove=c||t,this.ondragend=d||t,this.onswipestart=u||t,this.onswipeend=l||t,this.pointers=[],this.events=[],this._swiped=!1,this._offset=new this.Vector(0,0)};return r.spawn=function(t){r.instances.push(t),t.handleEvents()},r.kill=function(t){var e=r.instances.indexOf(t);-1!==e&&(r.instances.splice(e,1),t.unhandleEvents())},r.notify=function(t){for(var e,i=0;i<r.instances.length;i++)(e=r.instances[i]).track(t),e.notify(),e.deactivate(),e.swipe(t),e.collect(),e.check()},r.position=function(t){return new this.Vector(r.clientX(t),r.clientY(t))},r.clientX=function(t){return t.clientX},r.clientY=function(t){return t.clientY},r.prototype.subscribe=function(t){this.events.push(t)},r.prototype.unsubscribe=function(t){var e=this.events.indexOf(t);-1!==e&&this.events.splice(e,1)},r.prototype.track=function(t){for(var e=this,i=0;i<this.pointers.length;i++){var s=e.pointers[i];s.pressed()&&s.track(t,e.movingAvarageFilter)}},r.prototype.notify=function(){for(var t=this,i=0;i<this.events.length;i++){var s=t.pointers.filter(e);s.length&&t.events[i](s)}},r.prototype.deactivate=function(){for(var t=this,e=0;e<this.pointers.length;e++)t.pointers[e].deactivate()},r.prototype.swipe=function(t){for(var e=this,i=0;i<this.pointers.length;i++){var s=e.pointers[i];s.swiped()&&s.swipe(t,325,e.deltaThreshold)}},r.prototype.collect=function(){this.pointers=this.pointers.filter(s)},r.prototype.check=function(){this._swiped?this.pointers.filter(n).length||(this._swiped=!1,this.onswipeend()):this.pointers.filter(n).length&&(this._swiped=!0,this.onswipestart())},r.prototype.find=function(t){for(var e=this,i=null,s=0;s<this.pointers.length;s++){var n=e.pointers[s];n.id===t&&(i=n)}return i||1===this.pointers.length&&this.pointers[0].swiped()&&((i=this.pointers[0]).id=t),i},r.prototype.add=function(t){this.pointers.push(t)},r.prototype.handleEvents=function(){window.PointerEvent?(this.el.addEventListener("pointerdown",this,!0),this.el.addEventListener("pointermove",this,!0),this.el.addEventListener("pointerup",this,!0),this.el.addEventListener("pointercancel",this,!0)):(this.el.addEventListener("mousedown",this,!0),this.el.addEventListener("touchstart",this,!0),this.el.addEventListener("touchmove",this,!0),this.el.addEventListener("touchend",this,!0),this.el.addEventListener("touchcancel",this,!0))},r.prototype.unhandleEvents=function(){window.PointerEvent?(this.el.removeEventListener("pointerdown",this,!0),this.el.removeEventListener("pointermove",this,!0),this.el.removeEventListener("pointerup",this,!0),this.el.removeEventListener("pointercancel",this,!0)):(this.el.removeEventListener("mousedown",this,!0),this.el.removeEventListener("touchstart",this,!0),this.el.removeEventListener("touchmove",this,!0),this.el.removeEventListener("touchend",this,!0),this.el.removeEventListener("touchcancel",this,!0))},r.prototype.handleEvent=function(t){switch(t.preventDefault(),t.type){case"pointerdown":case"mousedown":this._mousedownHandler(t);break;case"mousemove":case"pointermove":this._mousemoveHandler(t);break;case"mouseup":case"pointerup":case"pointercancel":this._mouseupHandler(t);break;case"touchstart":this._touchstartHandler(t);break;case"touchmove":this._touchmoveHandler(t);break;case"touchend":case"touchcancel":this._touchendHandler(t)}},r.prototype.getId=function(t){return null!=t.pointerId?t.pointerId:t.identifier?t.identifier:-1},r.prototype.tap=function(t){var e=this.el.getBoundingClientRect();this._offset=new this.Vector(e.left,e.top);var i=this.getId(t),s=this.Vector,n=this.find(i);n||(n=new o({id:i,Vector:s}),this.add(n)),n.tap(r.position(t).isub(this._offset)),this.ondragstart()},r.prototype.drag=function(t){var e=r.position(t).isub(this._offset),i=this.getId(t);this.find(i).drag(e),this.ondragmove()},r.prototype.release=function(t){var e=this.getId(t);this.find(e).launch(this.velocityThreshold,this.amplitudeFactor),this.ondragend()},r.prototype._mousedownHandler=function(t){window.PointerEvent?t.target.setPointerCapture(t.pointerId):(document.addEventListener("mousemove",this,!0),document.addEventListener("mouseup",this,!0)),this.tap(t)},r.prototype._mousemoveHandler=function(t){("mousemove"===t.type||this.pointers.filter(i).length)&&this.drag(t)},r.prototype._mouseupHandler=function(t){window.PointerEvent?t.target.releasePointerCapture(t.pointerId):(document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0)),this.release(t)},r.prototype._touchstartHandler=function(t){for(var e=this,i=0;i<t.changedTouches.length;i++)e.tap(t.changedTouches[i])},r.prototype._touchmoveHandler=function(t){for(var e=this,i=0;i<t.targetTouches.length;i++)e.drag(t.targetTouches[i])},r.prototype._touchendHandler=function(t){for(var e=this,i=0;i<t.changedTouches.length;i++)e.release(t.changedTouches[i])},r.VELOCITY_THRESHOLD=10,r.AMPLITUDE_FACTOR=.8,r.DELTA_THRESHOLD=.5,r.MOVING_AVARAGE_FILTER=200,r.instances=[],r});
