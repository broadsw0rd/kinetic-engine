!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Kinetic=e()}(this,function(){"use strict";function t(t,e){return e={exports:{}},t(e,e.exports),e.exports}function e(t){return t.activated()}function i(t){return t.activated()||t.pressed()}var n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o=t(function(t,e){!function(i,n){"object"==typeof e&&"undefined"!=typeof t?t.exports=n():"function"==typeof define&&define.amd?define(n):i.Vector=n()}(n,function(){function t(t,e){this.x=t||0,this.y=e||0}function e(t){this.vector=t,this.__idx=0}return t.displayName="Vector",t.from=function(e){return new t(e[0],e[1])},t.fromAngle=function(e,i){return new t(i*Math.cos(e),i*Math.sin(e))},t.parse=function(e){return t.from(e.trim().replace(","," ").split(/\s+/).map(parseFloat))},t.add=function(t,e){return e.add(t)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.iadd=function(t,e){return e.iadd(t)},t.prototype.iadd=function(t){return this.x+=t.x,this.y+=t.y,this},t.sub=function(t,e){return e.sub(t)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.isub=function(t,e){return e.isub(t)},t.prototype.isub=function(t){return this.x-=t.x,this.y-=t.y,this},t.mul=function(t,e){return e.mul(t)},t.prototype.mul=function(e){return new t(this.x*e,this.y*e)},t.imul=function(t,e){return e.imul(t)},t.prototype.imul=function(t){return this.x*=t,this.y*=t,this},t.div=function(t,e){return e.div(t)},t.prototype.div=function(e){return new t(this.x/e,this.y/e)},t.idiv=function(t,e){return e.idiv(t)},t.prototype.idiv=function(t){return this.x/=t,this.y/=t,this},t.lerp=function(t,e,i){return t.lerp(e,i)},t.prototype.lerp=function(e,i){var n=(1-i)*this.x+i*e.x,o=(1-i)*this.y+i*e.y;return new t(n,o)},t.normalized=function(t){return t.normalized()},t.prototype.normalized=function(){var e=this.x,i=this.y,n=Math.sqrt(e*e+i*i);return n>0?new t(e/n,i/n):new t(0,0)},t.normalize=function(t){return t.normalize()},t.prototype.normalize=function(){var t=this.x,e=this.y,i=Math.sqrt(t*t+e*e);return i>0&&(this.x=t/i,this.y=e/i),this},t.magnitude=function(t){return t.magnitude()},t.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.dot=function(t,e){return e.dot(t)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.distance=function(t,e){return e.distance(t)},t.prototype.distance=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},t.angleOf=function(t){return t.angleOf()},t.prototype.angleOf=function(){return Math.atan2(this.y,this.x)},t.angleTo=function(t,e){return e.angleTo(t)},t.prototype.angleTo=function(t){return Math.acos(this.dot(t)/this.magnitude()*t.magnitude())},t.reset=function(t,e){return e.reset(t)},t.prototype.reset=function(t){return this.x=t.x,this.y=t.y,this},t.zero=function(t){return t.zero()},t.prototype.zero=function(){return this.x=0,this.y=0,this},t.set=function(t,e,i){return i.set(t,e)},t.prototype.set=function(t,e){return this.x=t||0,this.y=e||0,this},t.copy=function(t){return t.copy()},t.prototype.copy=function(){return new t(this.x,this.y)},t.toJSON=function(t){return t.toJSON()},t.prototype.toJSON=function(){return[this.x,this.y]},t.toString=function(t){return t?t.toString():Function.prototype.toString.call(this)},t.prototype.toString=function(){return this.x.toFixed(3)+" "+this.y.toFixed(3)},"undefined"!=typeof Symbol&&Symbol.toStringTag&&(t.prototype[Symbol.toStringTag]="Vector"),t.toArray=function(t){return t.toArray()},t.prototype.toArray=function(){return[this.x,this.y]},t.equals=function(t,e){return t.equals(e)},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.compare=function(t,e){return t.compare(e)},t.prototype.compare=function(t){var e=this.magnitude(),i=t.magnitude();return(e>i)-(i>e)},Object.defineProperties(t.prototype,{xx:{configurable:!0,get:function(){return new t(this.x,this.x)},set:function(t){this.x=t.x,this.y=t.x}},xy:{configurable:!0,get:function(){return new t(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}},yx:{configurable:!0,get:function(){return new t(this.y,this.x)},set:function(t){this.x=t.y,this.y=t.x}},yy:{configurable:!0,get:function(){return new t(this.y,this.y)},set:function(t){this.x=t.y,this.y=t.y}}}),e.prototype.next=function(){return 0===this.__idx?(this.__idx++,{done:!1,value:this.vector.x}):1===this.__idx?(this.__idx++,{done:!1,value:this.vector.y}):{done:!0,value:void 0}},"undefined"!=typeof Symbol&&Symbol.iterator&&(t.prototype[Symbol.iterator]=function(){return new e(this)}),t})}),r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=100,u=function(){function t(e){var i=e.id;r(this,t),this.id=i,this.position=new o(0,0),this.delta=new o(0,0),this.velocity=new o(0,0),this.amplitude=new o(0,0),this._startPosition=new o(0,0),this._pressed=!1,this._activated=!1,this._swiped=!1,this._timestamp=0,this._trackTime=0,this._elapsed=0}return t.prototype.tap=function(t){this.velocity=new o(0,0),this.amplitude=new o(0,0),this._startPosition=t,this._timestamp=0,this._trackTime=0,this._elapsed=0,this._pressed=!0},t.prototype.drag=function(t){this.position=t,this.delta.iadd(this.position.sub(this._startPosition)),this._startPosition=this.position,this._activated=!0},t.prototype.launch=function(t,e){this.velocity.magnitude()>t&&(this.amplitude=this.velocity.imul(e),this._swiped=!0),this._pressed=!1,this._trackTime=0},t.prototype.track=function(t,e){if(this._timestamp=this._timestamp||t,this._trackTime=this._trackTime||t,t-this._trackTime>=s){this._elapsed=t-this._timestamp,this._timestamp=t,this._trackTime=0;var i=this.delta.mul(e).idiv(1+this._elapsed);this.velocity=i.lerp(this.velocity,.2)}},t.prototype.swipe=function(t,e,i){this._elapsed=t-this._timestamp,this.delta=this.amplitude.mul(Math.exp(-this._elapsed/e)),this.delta.magnitude()>i?this._activated=!0:this._swiped=!1},t.prototype.deactivate=function(){this.delta.zero(),this._activated=!1},t.prototype.activated=function(){return this._activated},t.prototype.pressed=function(){return this._pressed},t.prototype.swiped=function(){return this._swiped},t}(),h=325,a=-1,c=function(){function t(e){var i=e.el,n=e.velocityThreshold,s=e.amplitudeFactor,u=e.deltaThreshold,h=e.movingAvarageFilter;r(this,t),this.el=i,this.velocityThreshold=n||t.VELOCITY_THRESHOLD,this.amplitudeFactor=s||t.AMPLITUDE_FACTOR,this.deltaThreshold=u||t.DELTA_THRESHOLD,this.movingAvarageFilter=h||t.MOVING_AVARAGE_FILTER,this.pointers=[],this.events=[],this._offset=new o(0,0)}return t.spawn=function(e){t.instances.push(e),e.handleEvents()},t.kill=function(e){var i=t.instances.indexOf(e);i!==-1&&(t.instances.splice(i,1),e.unhandleEvents())},t.notify=function(e){for(var i,n=0;n<t.instances.length;n++)i=t.instances[n],i.track(e),i.notify(),i.deactivate(),i.swipe(e),i.collect()},t.position=function(e){return new o(t.clientX(e),t.clientY(e))},t.clientX=function(t){return t.clientX},t.clientY=function(t){return t.clientY},t.prototype.subscribe=function(t){this.events.push(t)},t.prototype.unsubscribe=function(t){var e=this.events.indexOf(t);e!==-1&&this.events.splice(e,1)},t.prototype.track=function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];i.pressed()&&i.track(t,this.movingAvarageFilter)}},t.prototype.notify=function(){for(var t=0;t<this.events.length;t++){var i=this.pointers.filter(e);i.length&&this.events[t](i)}},t.prototype.deactivate=function(){for(var t=0;t<this.pointers.length;t++)this.pointers[t].deactivate()},t.prototype.swipe=function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];i.swiped()&&i.swipe(t,h,this.deltaThreshold)}},t.prototype.collect=function(){this.pointers=this.pointers.filter(i)},t.prototype.find=function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.id===t)return i}return null},t.prototype.add=function(t){this.pointers.push(t)},t.prototype.handleEvents=function(){this.el.addEventListener("mousedown",this),this.el.addEventListener("pointerdown",this),this.el.addEventListener("touchstart",this),this.el.addEventListener("touchmove",this),this.el.addEventListener("touchend",this)},t.prototype.unhandleEvents=function(){this.el.removeEventListener("mousedown",this),this.el.removeEventListener("pointerdown",this),this.el.removeEventListener("touchstart",this),this.el.removeEventListener("touchmove",this),this.el.removeEventListener("touchend",this)},t.prototype.handleEvent=function(t){switch(t.preventDefault(),t.type){case"pointerdown":case"mousedown":this._mousedownHandler(t);break;case"mousemove":case"pointermove":this._mousemoveHandler(t);break;case"mouseup":case"pointerup":this._mouseupHandler(t);break;case"touchstart":this._touchstartHandler(t);break;case"touchmove":this._touchmoveHandler(t);break;case"touchend":this._touchendHandler(t)}},t.prototype.getId=function(t){return null!=t.pointerId?t.pointerId:t.identifier?t.identifier:a},t.prototype.tap=function(e){var i=this.el.getBoundingClientRect();this._offset=new o(i.left,i.top);var n=this.getId(e),r=this.find(n);r||(r=new u({id:n}),this.add(r)),r.tap(t.position(e).isub(this._offset))},t.prototype.drag=function(e){var i=t.position(e).isub(this._offset),n=this.getId(e),o=this.find(n);o.drag(i)},t.prototype.release=function(t){var e=this.getId(t),i=this.find(e);i.launch(this.velocityThreshold,this.amplitudeFactor)},t.prototype._mousedownHandler=function(t){document.addEventListener("mousemove",this),document.addEventListener("pointermove",this),document.addEventListener("mouseup",this),document.addEventListener("pointerup",this),this.tap(t)},t.prototype._mousemoveHandler=function(t){this.drag(t)},t.prototype._mouseupHandler=function(t){document.removeEventListener("pointermove",this),document.removeEventListener("mousemove",this),document.removeEventListener("pointerup",this),document.removeEventListener("mouseup",this),this.release(t)},t.prototype._touchstartHandler=function(t){for(var e=0;e<t.changedTouches.length;e++)this.tap(t.changedTouches[e])},t.prototype._touchmoveHandler=function(t){for(var e=0;e<t.targetTouches.length;e++)this.drag(t.targetTouches[e])},t.prototype._touchendHandler=function(t){for(var e=0;e<t.changedTouches.length;e++)this.release(t.changedTouches[e])},t}();return c.Vector=o,c.VELOCITY_THRESHOLD=10,c.AMPLITUDE_FACTOR=.8,c.DELTA_THRESHOLD=.5,c.MOVING_AVARAGE_FILTER=200,c.instances=[],c});
